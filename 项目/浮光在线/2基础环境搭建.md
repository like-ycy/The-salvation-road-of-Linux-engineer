# 基础环境搭建及代码托管

## 1、创建虚拟环境

anaconda、miniconda、virtualenv

```python
conda create -n fuguang python=3.8
```



## 2、相关命令复习

```python
# anaconda或miniconda
创建虚拟环境：               conda create -n 虚拟环境名称 python=版本号
查看所有虚拟环境：           conda env list
使用虚拟环境：               source activate 虚拟环境名称
退出当前虚拟环境：           conda deactivate
删除虚拟环境（必须先退出虚拟环境内部才能删除当前虚拟环境）:
                           conda remove -n 虚拟环境名称 --all
在当前虚拟环境安装模块       conda install -c conda-forge 包名==版本号
在当前虚拟环境移除模块       conda remove 包名
其他相关命令：
    查看虚拟环境中安装的包：               pip freeze  或者 pip list
    收集当前环境中安装的包及其版本：        pip freeze > requirements.txt
    在部署项目的服务器中安装项目使用的模块： pip install -r requirements.txt
```

提示:

- 虚拟环境只会管理虚拟环境内部的模块和python解析器，对于源代码是毫无关系，与其他语言也没有关系，只针对当前使用的python

- 创建虚拟环境需要联网
- 创建成功后, 需要手动切换到虚拟环境中
- 工作在虚拟环境上, 终端提示符最前面会出现 “(虚拟环境名称)”



## 3、技术选型

#### 外部依赖

1. 注册支付宝的开发者账号。https://open.alipay.com/platform/home.htm

2. 注册阿里云账号,如果可以购买一个ESC服务器，[先不要买。可以在项目第10天的再买]

3. 注册[容联云短信接口](https://www.yuntongxun.com/)平台的账号 。

4. 注册保利威视频服务平台的账号[先不要注册，有个7天免费的测试开发时间，项目最后第2天注册]

5. 注册gitee[码云]的账号。等下课间就要注册。[公司里面一般使用gitlab]

6. 如果有条件的,可以申请一个域名进行备案[ICP备案和公安部备案],如果没有的话, 可以注册natapp

   在哪里买的服务器，最好就在哪里买域名。不在同一个平台购买的话备案有问题的。

7. 开通阿里云OSS对象存储。

8. 注册一个163邮箱。

9. 注册百度地图开发者。

#### 依赖包安装

```
pip install django==3.2.9  -i https://pypi.douban.com/simple

pip install djangorestframework  -i https://pypi.douban.com/simple

pip install Pillow  -i https://pypi.douban.com/simple

conda install -c conda-forge PymySQL
```



#### 服务器架构

![image-20210707113052025](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210707113052025.png)

## 4、搭建项目

### 4.1 创建服务端项目

```python
cd ~/Desktop
# 创建工程目录，将来在这个目录下创建服务端项目和客户端项目。
mkdir fuguang
cd fuguang
# 创建api服务端项目
django-admin startproject fuguangapi
```



### 4.2 打开项目

在pycharm中打开项目

![image-20210707113606335](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210707113606335.png)

设置虚拟环境

![image-20210707113637356](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210707113637356.png)

![image-20210707113708576](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210707113708576.png)

![image-20210707113810662](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210707113810662.png)

![image-20210707113829279](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210707113829279.png)

![image-20210707114003988](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210707114003988.png)

启动django项目

![image-20210707114205272](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210707114205272.png)

点选右上角的manage，修改启动参数

![image-20210707114245606](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210707114245606.png)

![image-20210707114314627](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210707114314627.png)

![image-20210707114518883](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210707114518883.png)

点击运行项目，访问地址：`http://127.0.0.1:8000`，效果：

![1557367991756](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/1557367991756.png)

提示：

```
在pycharm中如果要使用已经创建好的虚拟环境，则必须设置pycharm中的python解释器，设置为虚拟环境中的python。
```



### 4.3 调整目录

```
fuguang/                  # 工程目录
  ├── docs/               # 项目相关资料保存目录
  ├── fuguangweb/         # 前端项目目录
  ├── fuguangapi/         # api服务端项目目录
       ├── manage.py
       ├── logs/          # 项目运行时/开发时日志目录
       ├── fuguangapi/     # 项目主应用，开发时的代码保存
       │    ├── apps/      # 开发者的代码保存目录，以模块[子应用]为目录保存
       │    ├── libs/      # 第三方类库的保存目录[第三方组件、模块]
       │    ├── settings/
       │         ├── dev.py   # 项目开发时的本地配置[不需要上传到线上或者服务器]
       │         ├── pro.py   # 项目上线时的运行配置
       │    ├── urls.py    # 总路由
       │    └── utils/     # 自定义封装的类库、函数模块[子应用]的公共函数类库[自己开发的组件]
       └── scripts/       # 保存项目运营时的维护项目的脚本文件[python或者shell脚本]
```

在pycharm编辑器中开发服务端项目时,必须指定项目目录才能运行，例如,开发后端项目,则必须选择的目录是fuguangapi



### 4.4 分不同运行环境进行项目配置

开发者本地的环境、目录、数据库密码和线上的服务器都会不一样,所以我们的配置文件可以针对不同的系统分成多分.

1. 在项目主应用fuguangapi下,创建一个settings的配置文件存储目录
2. 根据线上线下两种情况分别创建2个配置文件 dev.py和pro.py
3. 把原来项目主应用的settings.py配置文件改名，并把内容复制2份到dev.py和pro.py里面
4. 修改mange.py中加载配置的路径。

新的配置目录settings:

![image-20211104102707082](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20211104102707082.png)

接下来,就可以根据在manage.py中根据不同的情况导入对应的配置文件了。

![image-20210707120425937](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210707120425937.png)



### 4.5 创建代码版本

在当前我们开发的fuguang工程包含了2个项目：api服务端和vue客户端。所以，一般在企业中，往往都是针对不同的项目创建不同的仓库，但是这里，我们现在学习的时候是没有那么人手的。所以我们针对当前整个fuguang工程搭建一个git代码仓库即可。

cd 进入到自己希望存储代码的目录路径，并创建本地仓库.git【pycharm直接打开终端就是项目根目录了。无须cd了】
新创建的本地仓库.git是个空仓库

```python
cd ~/Desktop/fuguang
git init
```

![image-20210906162807127](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210906162807127.png)

### 4.6 配置用户名和邮箱

```bash
git config user.name 'mooluo'
git config user.email '649641514@qq.com'

# git config --global user.name 'moluo'
# git config --global user.email '649641514@qq.com'
```

### 4.7 在gitee平台创建工程对应的仓库

1） 这里我们是学习，所以我这创建公有项目库

![image-20210906153341474](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210906153341474.png)

![image-20210906153359617](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210906153359617.png)

选择git-flow自定义分支模型。

创建私有空仓库以后的界面:

![image-20210708111504048](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210708111504048.png)

![image-20210906154121174](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210906154121174.png)

2）使用ssh连接git仓库

```python
# 例如我的码云是 649641514@qq.com
ssh-keygen -t rsa -C "649641514@qq.com"
cat /home/moluo/.ssh/id_rsa.pub # 把公钥进行复制到码云平台上 https://gitee.com/profile/sshkeys

# 切换项目的连接地址
git remote remove origin # 删除仓库地址
git remote add origin git@gitee.com:mooluo_admin/fuguang36.git  # 新仓库地址
```

![image-20210708123023607](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210708123023607.png)

![image-20210708123348356](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210708123348356.png)

![image-20210708123505051](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210708123505051.png)

![image-20210708123534335](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210708123534335.png)

```bash
git remote remove origin
git remote add origin git@gitee.com:mooluo_admin/fuguang36.git
```



接下来，我们就把上面创建好的本地项目提交到gitee码云上面

```bash
# .表示当前目录下所有的文件或目录提交到上传队列[上传队列也叫"暂存区"]
git add .

# 把本地上传队列的代码提交到本地仓库
git commit -m "项目初始化搭建"

# 提交代码给远程仓库
git push -u origin master
```

最终，成功提交了代码版本到gitee平台。效果：

![image-20210906164839005](2%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA.assets/image-20210906164839005.png)

使用``.gitignore``把一些垃圾文件或不必要记录版本历史的文件/目录过滤掉。

```bash
cd ~/Desktop/fuguang

# 先删除掉本地存在的，而.gitignore中要忽略的文件。
# 同步到线上仓库

# 新建git忽略文件
vim .gitignore

# .gitignore的内容在素材目录下

# :wq 保存文件
git add .
git commit -m "新建忽略文件"
git push -u origin master
```


