# 路由router

路由：是一种关系，是绑定了应用程序和url访问地址的一对一的映射关系。

在开发中，一般vue这类的框架中，我们所听到的路由就是指代了帮开发者完成路由关系绑定的工具类/对象。

vue开发中，我们前端项目可以通过安装vue-router插件，方便的实现类似服务端的路由分发机制。可以根据url地址的路径不同，让vue项目显示不同的页面组件内容。

中文文档：https://next.router.vuejs.org/zh/

```bash
# 在客户端项目的根目录下，package.json的同级目录
# yarn add vue-router@next  # 安装最新版本
yarn add vue-router@4     # 指定4.0版本
```

### 1 路由初始化

创建`src/router/index.js`，代码：

```typescript
// 路由列表
import {createRouter, createWebHistory} from 'vue-router';
import Home from "../views/Home";
import Register from "../views/Register";

const router = createRouter({
    // history, 指定路由的模式, 此处默认使用的是hash模式, vue2.0版本中， mode: "history" / mode: "hash"
    //      createWebHashHistory    hash模式            ===>   http://localhost:5050/#/login
    //      createWebHistory        history模式         ===>   http://localhost:5050/login
    //      createMemoryHistory     带缓存的history模式   ===>   http://localhost:5050/
    history: createWebHistory(),
    // 路由列表
    routes:[
        {
            path: "/",           // 组件的访问路径，必须以斜杠开头
            name: "Home",        // 路由别名，一般名字保持跟组件对象名一致，但是格式是字符串的
            component: Home,     // 组件对象，不能加引号，直接填写对象即可
        },
        {
            path: "/home",           // url地址，一个组件可以绑定多个url地址
            name: "Home",
            component: Home,
        },
        {
            path: "/reg",         // url地址
            name: "Register",     // 路由别名
            component: Register,  // url对应的组件
        },
    ],
})



export default router;
```

注册路由组件到vue中

`src/main.js`,代码：

```typescript
import { createApp } from 'vue'
import App from './App.vue'

// 注册[注入]路由组件实例对象到vm中
import router from "./router";
// 客户端vue中，目录下的index.js相当于 python中的__init__.py，只是index.js中的代码不会像__init__.py，那样自动执行而已
// import router from "./router/index";

createApp(App).use(router).mount('#app')
```

切换路由

router-view是vue-router提供的一个组件，这个组件可以根据不同的url地址，读取路由列表中对应的组件。

`App.vue`，代码：

```vue
<template>
  <router-view></router-view>
</template>

<script>
export default {
  name: 'App',
}
</script>

<style>

</style>
```



    在vue-router被注册到vue项目中时，vue-router会自动给vue组件对象内部新增2个路由操作的子对象
    this.$router   用于实现页面跳转效果
    this.$route    用于获取来自地址栏的参数

### 2 页面跳转

```vue
标签跳转 
    router-link组件是vue-router组件提供的，本质上就是js替换页面部分内容，模拟页面跳转效果
    将来项目中，router-link用于跳转站内的页面，a标签用于跳转站外的页面
<router-link to="/" :class="{current: current===0}">站点首页</router-link>
<router-link to="/reg" :class="{current: current===1}">登录注册</router-link>

js跳转
    vue-router组件提供的，标签跳转不会代码验证和拦截，
    所以有时希望跳转前进行一些拦截操作，就需要使用js跳转]
<template>
    <li><a href="" @click.prevent="goto('/')">js跳转到首页</a></li>
    <li><a href="" @click.prevent="goto('/register')">js跳转到注册</a></li>
</template>
<script>
export default {
  name: "Menu",
  // ...
  methods:{
    goto(url){
      this.$router.push(url);        // 跳转到指定的url地址对应的页面中
      // this.$router.go(1)          // 跳转到指定的n个页面，正数表示前进，负数表示后台
      // this.$router.forward()      // 前进下一个页面，相当于go(1)
      // this.$router.back()         // 返回上一页，相当于go(-1)
    }
  }
}
</script>
```



### 3 页面组件之间的参数传递和接收

在上面的页面跳转中， 不管我们使用的router-link组件标签，还是直接通过`this.$router`，实际上都是最终都是$router来进行页面跳转的。那么除了$router用于进行页面的跳转以外，在vue-router注册到vue框架以后，vue-router还提供了一个$route对象给我们用于获取不同页面之间的参数传递和接收的操作。

```
this.$router.push("url地址")  # 跳转当前网站内部的任意地址
this.$router.back()           # 返回上一页

this.$route.query.<变量名>    # 接收页面跳转时，地址栏附带的查询字符串参数中指定变量名对应的值
      /home?name=xiaoming    # 接收xiaoming，则可以在代码： this.$route.query.name

this.$route.params.<路径别名> # 接收页面跳转时，地址栏中url路径中指定部分的路径别名对应的具体值 
      /user/100              # 接收100，则需要完成2件事件：
                             # 第1，在router/index.js文件中，声明路由的格式为： path: "/user/:num"
                             # 第2，在页面跳转后，新页面中的js代码里面接收100，则 this.$route.params.num
```

src/views/List.vue，代码：

```vue
<template>
  <p>List页面</p>
  <p>查询字符串参数的传递和接收</p>
  <router-link to="/goods?id=5">5号商品</router-link>
  <br>
  <router-link to="/goods?id=7">7号商品</router-link>
  <br>
  <router-link to="/goods?id=7&cate=shucai">蔬菜分类下的7号商品</router-link>
  <br>
  <p>路由参数，作为路径的一部分</p>
  <router-link to="/user/100/">user_id==100</router-link>
</template>

<script>
export default {
  name: "List"
}
</script>

<style scoped>

</style>
```

Goods.vue，代码：

```vue
<template>
    <p>Goods页面</p>
    <p>{{goods_id_query}}号商品的详细信息</p>
    <p>{{goods_cate_query}}分类下的{{goods_id_query}}号商品的详细信息</p>
</template>

<script>
export default {
  name: "Goods",
  data(){
    return {
      goods_id_query: 0,
      goods_cate_query:"",
    }
  },
  created() {
    // this.$route.query 会自动收集当前页面的url地址中所有的查询字符串参数
    this.goods_id_query = this.$route.query.id;
    this.goods_cate_query = this.$route.query.cate;
  }
}
</script>

<style scoped>

</style>
```

User.vue，代码：

```vue
<template>
  <p>User页面</p>
  <p>id={{user_id_params}}的用户信息</p>
</template>

<script>
export default {
  name: "User",
  data(){
    return {
      user_id_params: 0,
    }
  },
  created() {
    this.user_id_params = this.$route.params.id;
  }
}
</script>

<style scoped>

</style>
```



router/index.js，代码：

```javascript
// 路由列表
import {createRouter, createWebHistory} from 'vue-router';
import Home from "../views/Home";
import Register from "../views/Register";
import List from "../views/List";
import Goods from "../views/Goods";
import User from "../views/User";

const router = createRouter({
    // history, 指定路由的模式, 此处默认使用的是hash模式, vue2.0版本中， mode: "history" / mode: "hash"
    //      createWebHashHistory    hash模式            ===>   http://localhost:5050/#/login
    //      createWebHistory        history模式         ===>   http://localhost:5050/login
    //      createMemoryHistory     带缓存的history模式   ===>   http://localhost:5050/
    history: createWebHistory(),
    // 路由列表
    routes:[
        {
            path: "/",           // 组件的访问路径，必须以斜杠开头
            name: "Home",        // 路由别名，一般名字保持跟组件对象名一致，但是格式是字符串的
            component: Home,     // 组件对象，不能加引号，直接填写对象即可
        },
        {
            path: "/reg",         // url地址
            name: "Register",     // 路由别名
            component: Register,  // url对应的组件
        },
        {
            path: "/list",
            name: "List",
            component: List,  // Alt+Enter 自动导包
        },
        {
            path: "/goods",
            name: "Goods",
            component: Goods,  // Alt+Enter 自动导包
        },
        {
            // path: "/user/:id",      // 必填参数，不限制任何类型
            // path: "/user/:id([0-9]+)", // 必填参数，使用了正则限制格式
            path: "/user/:id([0-9]+)?",// 可选参数，填写了参数以后，会按正则进行格式匹配
            name: "User",
            component: User,  // Alt+Enter 自动导包
        },
    ],
})

export default router;
```

你可以在同一个路由中设置有多个路由参数，它们会映射到 `$route.params` 上的相应字段。例如：

| 匹配模式（router/index.js）    | 匹配路径（浏览器地址栏） | $route.params（组件代码）                |
| ------------------------------ | ------------------------ | ---------------------------------------- |
| /users/:username               | /users/eduardo           | `{ username: 'eduardo' }`                |
| /users/:username/posts/:postId | /users/eduardo/posts/123 | `{ username: 'eduardo', postId: '123' }` |

除了 `$route.params` 之外，`$route` 对象还公开了其他有用的信息，如 `$route.query`（如果 URL 中存在参数）、`$route.hash` 等。

### 4 嵌套路由

嵌套路由是vue-router提供给开发者应用在同一个页面组件下公共部分内容不变的情况下，切换不同子组件的时候使用的。

`router/index.js`，代码：

```typescript
// 路由列表
import {createRouter, createWebHistory} from 'vue-router';
import Home from "../views/Home";
import Register from "../views/Register";
import List from "../views/List";
import Goods from "../views/Goods";
import User from "../views/User";
import UserInfo from "../components/user/UserInfo";
import Password from "../components/user/Password";

const router = createRouter({
    // history, 指定路由的模式, 此处默认使用的是hash模式, vue2.0版本中， mode: "history" / mode: "hash"
    //      createWebHashHistory    hash模式            ===>   http://localhost:5050/#/login
    //      createWebHistory        history模式         ===>   http://localhost:5050/login
    //      createMemoryHistory     带缓存的history模式   ===>   http://localhost:5050/
    history: createWebHistory(),
    // 路由列表
    routes:[
        // ... 代码省略
        {
            // path: "/user/:id",      // 必填参数，不限制任何类型
            // path: "/user/:id([0-9]+)", // 必填参数，使用了正则限制格式
            path: "/user/:id([0-9]+)?",// 可选参数，填写了参数以后，会按正则进行格式匹配
            name: "User",
            component: User,  // Alt+Enter 自动导包
            children: [ // 子路由列表
                {
                    path: "info",   // 子路由的声明，左边不能有斜杠，同时，访问路径：父级路由/当前子路由
                    name: "UserInfo",
                    component: UserInfo
                },
                {
                    path: "password",
                    name: "Password",
                    component: Password
                }
            ]
        },
    ],
})



export default router;
```

`src/views/User.vue`，代码：

```vue
<template>
  <p>User页面</p>
  <p>id={{user_id_params}}的用户信息</p>
  <router-view></router-view>
</template>

<script>
export default {
  name: "User",
  data(){
    return {
      user_id_params: 0,
    }
  },
  created() {
    this.user_id_params = this.$route.params.id;
  }
}
</script>

<style scoped>

</style>
```

`src/components/user/UserInfo.vue`，代码：

```vue
<template>
  <p>用户基本信息查看</p>
</template>

<script>
export default {
  name: "UserInfo"
}
</script>

<style scoped>

</style>
```

`src/components/user/Password.vue`，代码：

```vue
<template>
  <p>修改密码页面</p>
</template>

<script>
export default {
  name: "Password"
}
</script>

<style scoped>

</style>
```

可以通过以下地址分别访问用户中心的不同页面内容：

```bash
http://localhost:8080/user/100/info     ---> UserInfo.vue
http://localhost:8080/user/100/password ---> Password.vue
```



### 5 路由守卫

[路由守卫](https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%AF%BC%E8%88%AA%E5%AE%88%E5%8D%AB)：也叫导航守卫，功能作用类似于上面的axios的拦截器。我们可以基于导航守卫编写一些在页面跳转过程中需要编写的公共代码，例如：权限的验证，页面的公共信息初始化，页面跳转之前的一些公共逻辑。

#### 前置守卫

```typescript
const router = createRouter({ ... })

router.beforeEach((to, from) => {
  // ...
  // 返回 false 以取消导航
  return false
})
```

`src/router/index.js`，代码：

```javascript
// 路由列表
import {createRouter, createWebHistory} from 'vue-router';
import Home from "../views/Home";
import Register from "../views/Register";
import List from "../views/List";
import Goods from "../views/Goods";
import User from "../views/User";
import UserInfo from "../components/user/UserInfo";
import Password from "../components/user/Password";

const router = createRouter({
    // history, 指定路由的模式, 此处默认使用的是hash模式, vue2.0版本中， mode: "history" / mode: "hash"
    //      createWebHashHistory    hash模式            ===>   http://localhost:5050/#/login
    //      createWebHistory        history模式         ===>   http://localhost:5050/login
    //      createMemoryHistory     带缓存的history模式   ===>   http://localhost:5050/
    history: createWebHistory(),
    // 路由列表
    routes:[
        {
            path: "/",           // 组件的访问路径，必须以斜杠开头
            name: "Home",        // 路由别名，一般名字保持跟组件对象名一致，但是格式是字符串的
            component: Home,     // 组件对象，不能加引号，直接填写对象即可
        },
        {
            path: "/reg",         // url地址
            name: "Register",     // 路由别名
            component: Register,  // url对应的组件
        },
        {
            path: "/list",
            name: "List",
            component: List,  // Alt+Enter 自动导包
        },
        {
            path: "/goods",
            name: "Goods",
            component: Goods,  // Alt+Enter 自动导包
        },
        {
            meta:{
                title: "会员中心"
            },
            // path: "/user/:id",      // 必填参数，不限制任何类型
            // path: "/user/:id([0-9]+)", // 必填参数，使用了正则限制格式
            path: "/user/:id([0-9]+)?",// 可选参数，填写了参数以后，会按正则进行格式匹配
            name: "User",
            component: User,  // Alt+Enter 自动导包
            children: [ // 子路由列表
                {
                    meta:{
                        title: "会员信息",
                    },
                    path: "info",   // 子路由的声明，左边不能有斜杠，同时，访问路径：父级路由/当前子路由
                    name: "UserInfo",
                    component: UserInfo
                },
                {
                    meta: {
                        title: "修改密码",
                    },
                    path: "password",
                    name: "Password",
                    component: Password
                }
            ]
        },
    ],
})

// 全局前置守卫
// to 是一个路由对象，表示下一个页面的路由对象
// from 是一个路由对象，表示当前页面的路由对象
// router.beforeEach((to, from) => {
router.beforeEach((to) => {
  console.log(to);  // 相当于下一个页面组件中的 this.$routet
  document.title = to.meta.title;
  // 返回 false 以取消导航，阻止路由跳转页面
  // return false
})

export default router;
```



#### 后置守卫

```typescript
router.afterEach((to, from) => {
  // 公共代码
});
```

代码：

```javascript
// 路由列表
import {createRouter, createWebHistory} from 'vue-router';
import Home from "../views/Home";
import Register from "../views/Register";
import User from "../views/User";
import Profile from "../components/Profile";
import Settings from "../components/Settings";
const router = createRouter({
   // history, 指定路由的模式, 此处使用的是hash模式,vue2.0版本中， mode:"history" / mode:"hash"
   //      createWebHashHistory    hash模式            ===>   http://localhost:5050/#/login
   //      createWebHistory        history模式         ===>   http://localhost:5050/login
   //      createMemoryHistory     带缓存的history模式  ===>   http://localhost:5050/
    history: createWebHistory(),
    // 路由列表
    routes: [
        // {
        //     path:"url地址",
        //     component: 组件对象,
        //     name: "路由别名"
        // },
        {
            path:"/",         // 组件的访问路径，必须以斜杠开头
            component: Home,  // 不能加引号，直接填写对象即可
        },{
            path:"/home",         // 组件的访问路径，必须以斜杠开头
            component: Home,  // 不能加引号，直接填写对象即可
        },
        {
            path:"/reg",
            component: Register,
        },
        {
            path:"/login",
            component: Register,
        },
        {
            path:"/user", // 设置路由的一部分作为参数，写法必须是  :参数名
            component: User,
            children: [
              {
                // 当 /user/profile 匹配成功
                // Profile 将被渲染到 User 的 <router-view> 内部
                path: 'profile',
                component: Profile,
                meta:{
                    title: "我的资料"
                }
              },
              {
                // 当 /user/order 匹配成功
                // Order 将被渲染到 User 的 <router-view> 内部
                path: 'settings',
                component: Settings,
                // 路由元信息
                meta:{
                    title: "我的设置"
                }
              },
            ]
        },
    ]
});

// 前置守卫[路由跳转之前的前置守卫]
// router.beforeEach((to, from,next) => {
//     console.log("to=", to)       // 下一页页面的路由操作对象
//     console.log("from=", from)   // 当前页面的路由对象
//     console.log("next=", next)   // 这是页面跳转的回调函数，执行了以后就会进行页面跳转，当参数为false时，则不会跳转页面
//
//     if(to.query.name === "xiaoming" || to.path === "/login"){
//         console.log("通过")
//         next();
//     }else{
//         console.log("拦截")
//         next({path:"/login"}) // 让路由跳转页面到/login
//     }
// })

// 后置守卫[在页面跳转之后的]
router.afterEach((to, from) => {
    console.log("to=", to)       // 下一页页面的路由操作对象
    console.log("from=", from)   // 当前页面的路由对象
    console.log(to.meta.title)
    document.title = to.meta.title
})

export default router;
```



#### 独享守卫

```typescript
const routes = [ // 路由列表
  {
    path: '/users/:id',
    component: UserDetails,
    beforeEnter: (to, from) => {
      // reject the navigation
      return false
    },
  },
]
```

路由，代码：

```javascript
// 路由列表
import {createRouter, createWebHistory} from 'vue-router';
import Home from "../views/Home";
import Register from "../views/Register";
import List from "../views/List";
import Goods from "../views/Goods";
import User from "../views/User";
import UserFriend from "../views/UserFriend";
import UserOrder from "../views/UserOrder";
const router = createRouter({
   // history, 指定路由的模式, 此处使用的是hash模式,vue2.0版本中， mode:"history" / mode:"hash"
   //      createWebHashHistory    hash模式            ===>   http://localhost:5050/#/login
   //      createWebHistory        history模式         ===>   http://localhost:5050/login
   //      createMemoryHistory     带缓存的history模式  ===>   http://localhost:5050/
    history: createWebHistory(),
    // 路由列表
    routes: [
        // {
        //     path:"url地址",
        //     component: 组件对象,
        //     name: "路由别名"
        // },
        {
            path:"/",   // 组件的访问路径，必须以斜杠开头
            component: Home,  // 不能加引号，直接填写对象即可
        },
        {
            path:"/register",
            component: Register,
        },
        {
            path:"/list",
            component: List,
            beforeEnter: (to, from) => {
               console.log(to);
               console.log(from);
               // 返回值如果是true则表示直接允许跳转，返回false表示拦截不让页面跳转
               return true;
            },
        },
        {
            path:"/goods/:id", // 设置路由的一部分作为参数，写法必须是  :参数名
            component: Goods,
        },
        {
            path:"/user", // 设置路由的一部分作为参数，写法必须是  :参数名
            component: User,
            children: [
              {
                // 当 /user/:id/profile 匹配成功
                // UserProfile 将被渲染到 User 的 <router-view> 内部
                path: 'friend',
                component: UserFriend,
              },
              {
                // 当 /user/:id/profile 匹配成功
                // UserProfile 将被渲染到 User 的 <router-view> 内部
                path: 'order',
                component: UserOrder,
              },
            ]
        },
    ]
});


// 导航守卫

// 前置守卫，在页面跳转之前需要完成的判断逻辑，公共代码
router.beforeEach((to,from,next) => {
    // console.log(to);   // 下一个页面的路由对象
    // console.log(from); // 当前页面的路由对象
    // console.log(next);
    if(to.path != "/" && to.path != "/login"){
        if(to.query.user == "xiaoming"){
            next();  // 执行next就会往下一个页面跳转
        }else{
            // next(false); // 拦截跳转;
            next({path: "/login"});  // 调到登录页面
        }
    }
    // 放行
    next();
});

// 后置守卫
// router.afterEach((to, from, failure) => {
//   // console.log(failure);
//   console.log("对不起，您没有权限进入当前~");
//   if (!failure){
//       console.log((to.fullPath));
//   }
// });
export default router;
```
