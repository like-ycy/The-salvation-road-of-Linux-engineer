# 单文件组件的使用

## 创建单文件组件

![1552362045478](5%E5%8D%95%E6%96%87%E4%BB%B6%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8.assets/1552362045478.png)

组件文件名格式一般是大驼峰格式（每个单词首字母大写），以.vue结尾。

在组件中编辑三个标签，template标签中编写html视图、script标签操作vm对象和style标签编写css样式代码。

### 1 template 编写html代码的地方

template内部有且只能有一个子标签（2.0版本的限制，3.0版本不限制），组件所有的html代码必须被包含在这个子标签中。

```vue
<template>
  <div>
    <h1>Home.vue</h1>
    <button @click="num--" class="sub">-</button>
    <input type="text" size="1" v-model="num">
    <button @click="num++" class="add">+</button>
  </div>
</template>
```

### 2 script编写vue.js代码

```vue
<script>
export default {
  name: "Home",
  data (){
    return {
      num: 10,
    }
  },
  methods:{
    add(){
      this.num++;
    }
  },
  watch:{
    num(){
      if(this.num>20){
        this.num = 10;
      }
    }
  }
}
</script>
```

### 3 style编写当前组件的样式代码

```vue
<style scoped>
h1 {
  color: red;
}
.sub,.add{
  border: 1px solid red;
  padding: 4px 7px;
}
</style>
```



### 4  案例-点击加减数字

Home.vue

```vue
<template>
  <h1>Home.vue文件文件</h1>
  <button @click="num--" class="sub">-</button>
  <input type="text" size="1" v-model="num" />
  <button @click="num++" class="add">+</button>
</template>

<script>
export default {
  name: "Home",
  data() {
    return {
      num: 10,
    };
  },
  methods: {
    add() {
      this.nun++;
    },
  },
  watch: {
    num() {
      if (this.num > 20) {
        this.num = 10;
      }
    },
  },
};
</script>

<style scoped>
h1 {
  color: red;
}
.sub,
.add {
  border: 1px solid red;
  padding: 4px 7px;
}
</style>
```

在App.vue组件中注册并调用Home组件

```vue
<template>
  <img alt="Vue logo" src="./assets/logo.png" />
  <HelloWorld msg="Welcome to Your Vue.js App" />
  <Home></Home>
</template>

<script>
// import HelloWorld from "./components/HelloWorld.vue";
import Home from "./components/Home.vue";

export default {
  name: "App",
  components: {
    Home,
    // HelloWorld,
  },
};
</script>

<style>
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}
</style>

```

在开发vue项目之前，需要手动把 App.vue文件中关于HelloWorld组件代码以及默认的css样式，清除掉。

上面的代码效果：

![image-20211101172437661](5%E5%8D%95%E6%96%87%E4%BB%B6%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8.assets/image-20211101172437661.png)

### 5 使用pycharm启动项目

![image-20210628123404382](5%E5%8D%95%E6%96%87%E4%BB%B6%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8.assets/image-20210628123404382.png)

![image-20210628123349491](5%E5%8D%95%E6%96%87%E4%BB%B6%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8.assets/image-20210628123349491.png)

![image-20210628123329837](5%E5%8D%95%E6%96%87%E4%BB%B6%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8.assets/image-20210628123329837.png)

点击“ok”，保存即可。接下来， 点击绿色三角形按钮即可运行vue项目了。

![image-20210628123629976](5%E5%8D%95%E6%96%87%E4%BB%B6%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8.assets/image-20210628123629976.png)



## 组件的嵌套

有时候开发vue项目时,页面也可以算是一个大组件,同时页面也可以分成多个子组件.

例如,我们就可以声明一个页面组件保存目录`src/views`，并提供2个页面组件，分别是Home.vue和Register.vue,作为页面组件。同时在src/components创建一个子组件Menu.vue。

![image-20210629093810450](5%E5%8D%95%E6%96%87%E4%BB%B6%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8.assets/image-20210629093810450.png)

#### 在views目录下, 编写当前2个页面组件的代码。

Home.vue文件上面在components文件夹下已经创建了，把它移动到views文件夹中

Menu.vue，代码：

```vue
<template>
  <div class="menu">
    <a href="">首页</a>
    <a href="">列表页</a>
    <a href="">会员中心</a>
  </div>
</template>

<script>
export default {
  name: "Menu"
}
</script>

<style scoped>
.menu{
  height: 80px;
  overflow: hidden;
}
.menu a{
  float: left;
  height: 80px;
  line-height: 80px;
  text-align: center;
  width: 140px;
  background: blue;
  color: #fff;
}
</style>
```

接着在App.vue中引用Menu.vue和Home.vue

```vue
<template>
  <!-- <img alt="Vue logo" src="./assets/logo.png" /> -->
  <!-- <HelloWorld msg="Welcome to Your Vue.js App" /> -->
  <Menu></Menu>
  <Home></Home>
</template>

<script>
// import HelloWorld from "./components/HelloWorld.vue";
import Home from "./views/Home.vue";
import Menu from "./views/Menu.vue";

export default {
  name: "App",
  components: {
    Home,
    Menu,
    // HelloWorld,
  },
};
</script>

<style>
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}
</style>

```



此时，页面的访问效果如下:

![image-20211101101911883](5%E5%8D%95%E6%96%87%E4%BB%B6%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8.assets/image-20211101101911883.png)

后面如果还需要引入其他页面，按上面的流程作为参考，例如：我们需要在App.vue中继续加载Register.vue。

Register.vue，代码：

```vue
<template>
  <Menu></Menu>
  <h1>注册页面</h1>
</template>

<script>
import Menu from "../components/Menu"
export default {
  name: "Register",
  components:{
    Menu
  }
}
</script>

<style scoped>

</style>
```

不同的url地址将来肯定是加载不同的页面组件，所以我们可以根据不同url地址判断显示对应的页面组件，App.vue，代码：

```vue
<template>
  <Home v-if="url==='/'"></Home>
  <Register v-if="url==='/reg'"></Register>
</template>

<script>
import Home from "./views/Home.vue";
import Register from "./views/Register";
export default {
  name: 'App',
  data(){
    return {
      url: location.pathname,
    }
  },
  components: {
    Home,
    Register,
  }
}
</script>

<style>
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}
</style>
```

这样，访问/就会显示Home页面组件，访问/reg则会显示Register页面组件。当然，现在这种直接判断的方式并不专业，我们将来会在vue项目中安装并使用vue-router这种专业的路由插件来完成项目组件和url地址的映射关联。

此时整个项目的嵌套结构：

![image-20210629094906750](5%E5%8D%95%E6%96%87%E4%BB%B6%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8.assets/image-20210629094906750.png)



## 组件之间的数据传递

#### 父组件的数据传递给子组件

把父组件的数据传递给子组件.可以通过props属性来进行数据传递.

传递数据三个步骤：

1. 在父组件Home.veu中，调用子组件的组件名处，使用属性值的方式往下传递数据

   ```vue
   <template>
     <div>
       <Menu :current="0" msg="首页"></Menu>
       <h1>Home.vue</h1>
       <button @click="num--" class="sub">-</button>
       <input type="text" size="1" v-model="num">
       <button @click="num++" class="add">+</button>
     </div>
   </template>
   
   <script>
   import Menu from "../components/Menu";
   export default {
     name: "Home",
     data (){
       return {
         num: 10,
       }
     },
     methods:{
       add(){
         this.num++;
       }
     },
     watch:{
       num(){
         if(this.num>20){
           this.num = 10;
         }
       }
     },
     components:{
       Menu,
     }
   }
   </script>
   
   <style scoped>
   h1{
     color: red;
   }
   </style>
   ```

2. 在子组件Menu.vue中接受上面父组件传递的数据，需要在script标签中，使用props属性接受。写法有2种：

   ```vue
   <script>
   export default {
     name: "Menu",
     // 来自父组件的数据，全部通过props来接受，2种写法：json写法，数组写法
     // props:["msg","current","num"],  // 数组对象写法，可以不指定数据类型
     props: {
       // 变量名(只读): 数据类型
       msg: String,
       current: Number,
       num: {
         type: Number, // type: 数据类型: Number数值(整数,浮点数)、String字符串、Boolean布尔值、Array数组、Object对象、函数Function、异步对象Promise
         default: 0,   // default: 默认值，父组件没有专递数据进行了当前子组件时，可以采用默认值
       },
     }
   }
   </script>
   <style scoped>
   .menu{
     height: 80px;
     overflow: hidden;
   }
   .menu a{
     float: left;
     height: 80px;
     line-height: 80px;
     text-align: center;
     width: 140px;
     background: blue;
     color: #fff;
   }
   .menu a.current{
     background: cadetblue;
   }
   </style>
   ```

3. 在子组件中的template中使用父组件传递过来的数据.

   ```vue
   <template>
     msg={{msg}} - num={{num}}
     <div class="menu">
       <a href="/" :class="{current: current===0}">站点首页</a>
       <a href="/reg" :class="{current: current===1}">登录注册</a>
       <a href="" :class="{current: current===2}">会员中心</a>
     </div>
   </template>
   ```

步骤流程:

![image-20211101104719248](5%E5%8D%95%E6%96%87%E4%BB%B6%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8.assets/image-20211101104719248.png)

使用父组件传递数据给子组件时, 注意以下事项:

1. 传递数据是变量,则需要在属性左边添加英文冒号.

   传递数据是变量,这种数据称之为"动态数据传递"，父组件数据改动的时候，子组件中被随之改动。

   传递数据不是变量,这种数据称之为"静态数据传递"

2. 父组件中修改了数据,在子组件中会被同步修改。但是来自props的数据，在子组件是不能修改的，因为不是data中声明的。在开发时这种情况，也被称为"单向数据流"。




#### 子组件传递数据给父组件

在子组件中，通过`this.$emit()`来声明一个自定义的信号（vue中称之为自定义事件名），父组件中针对这个信号(自定义事件)在调用子组件的组件名处进行@监听。

Menu.vue，代码：

```vue
<template>
  msg={{msg}} - <button @click="myadd">num={{num}}</button>
  <div class="menu">
    <a href="/" :class="{current: current===0}">站点首页</a>
    <a href="/reg" :class="{current: current===1}">登录注册</a>
    <a href="" :class="{current: current===2}">会员中心</a>
  </div>
</template>

<script>
export default {
  name: "Menu",
  // 来自父组件的数据，全部通过props来接受，2种写法：json写法，数组写法
  // props:["msg","current","num"],  // 数组对象写法，可以不指定数据类型
  props: {
    // 变量名(只读): 数据类型
    msg: String,
    current: Number,
    num: {
      type: Number, // type: 数据类型: Number数值(整数,浮点数)、String字符串、Boolean布尔值、Array数组、Object对象、函数Function、异步对象Promise
      default: 0,   // default: 默认值，父组件没有专递数据进行了当前子组件时，可以采用默认值
    },
  },
  methods:{
    myadd(){
      console.log("子组件点击了")
      // 往父组件传递一个事件信号
      // this.$emit("事件名", 参数1,参数2,....)
      this.$emit("add_num", 2)
    }
  }
}
</script>
<style scoped>
.menu{
  height: 80px;
  overflow: hidden;
}
.menu a{
  float: left;
  height: 80px;
  line-height: 80px;
  text-align: center;
  width: 140px;
  background: blue;
  color: #fff;
}
.menu a.current{
  background: cadetblue;
}
</style>
```

和子组件中`this.$emit("自定义事件名称")`对应，父组件中声明一个同样名称的事件属性。

Home.vue，代码：

```vue
<template>
  <div>
    <Menu :current="0" msg="首页" :num="num" @add_num="son_add"></Menu>
    <h1>Home.vue</h1>
    <button @click="num--" class="sub">-</button>
    <input type="text" size="1" v-model="num">
    <button @click="num++" class="add">+</button>
  </div>
</template>
```

父组件中，声明一个方法用于在自定义事件发生时用于获取数据。

```vue
<script>
import Menu from "../components/Menu";
export default {
  name: "Home",
  data (){
    return {
      num: 10,
    }
  },
  methods:{
    add(){
      this.num++;
    },
    son_add(arg1){
      console.log(`父组件中接收的arg1=${arg1}`);
      this.num+=arg1;
    }
  },
  watch:{
    num(){
      if(this.num>20){
        this.num = 10;
      }
    }
  },
  components:{
    Menu,
  }
}
</script>
```


作业：

```
1. 在父组件views/Home.vue中的data选项中声明num1=10。传递到子组件components/Menu.vue中显示出来。
   提示：通过props接收num1，类型是Number
2. 在子组件components/Menu.vue中的data选项中声明num2=50，传递到父组件views/Home.vue中显示出来，是否在父组件中为num2单独创建一个对应的变量，自己决定。
   提示：this.$emit();
```

附加说明：

```JavaScript
// 在vue3.0中，针对父组件传值给子组件的过程中。如果父组件没有传递数据给子组件，而子组件希望预设默认值，则可以通过props进行自定义默认值或者通过验证方式强制要求父组件进行传递。
props: {
    // 基础的类型检查 (`null` 和 `undefined` 会通过任何类型验证)
    propA: Number,
    // 多个可能的类型
    propB: [String, Number],
    // 必填的字符串
    propC: {
      type: String,    // 表示数据类型
      required: true,  // 表示必填
      default: "",     // 表示默认值
    },
    // 带有默认值的数字
    propD: {
      type: Number,
      default: 100
    },
    // 带有默认值的对象
    propE: {
      type: Object,
      // 对象或数组默认值必须从一个工厂函数获取
      default() {
        return { message: 'hello' }
      }
    },
    // 自定义验证函数
    propF: {
      validator(value) {
        // 这个值必须匹配下列字符串中的一个
        return ['success', 'warning', 'danger'].includes(value)
      }
    },
    // 具有默认值的函数
    propG: {
      type: Function,
      // 与对象或数组默认值不同，这不是一个工厂函数 —— 这是一个用作默认值的函数
      default() {
        return 'Default function'
      }
    }
  }
```

