# 前端搭建

## 1、创建vite项目

```bash
cd 项目根目录
yarn create @vitejs/app
```

例如，我要把项目保存在~/Desktop桌面目录下，可以如下操作：

```bash
cd ~/Desktop/fuguang
yarn create @vitejs/app
```

根据需要在生成项目时，我们选择对应的选项, 效果：

![image-20210714063303996](4%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81.assets/image-20210714063303996.png)

![image-20210714063438823](4%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81.assets/image-20210714063438823.png)

根据上面的提示，我们已经把vue项目构建好了，下载依赖，运行测试服务器。

```bash
cd fuguangweb
yarn
yarn dev
```



![image-20210714063558277](4%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81.assets/image-20210714063558277.png)

![image-20210714063746703](4%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81.assets/image-20210714063746703.png)

成功运行项目，可以关闭终端了，接着在pycharm下运行vue项目，查看效果。

![image-20210714095830158](4%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81.assets/image-20210714095830158.png)

![image-20210714063843448](4%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81.assets/image-20210714063843448.png)

![image-20210714064001532](4%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81.assets/image-20210714064001532.png)

访问：http://localost:3000。效果：

![image-20210714064030043](4%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81.assets/image-20210714064030043.png)

把我们的前端项目进行git源代码管理。

把vite根目录下的`.gitignore`文件内容，复制补充路径，粘贴到父级目录fuguang下的`.gitignore`文件中。

```bash
*.sqlite3
mysql/volumes/

# Created by https://www.gitignore.io/api/django,python,jupyternotebook
# Edit at https://www.gitignore.io/?templates=django,python,jupyternotebook

### Django ###
*.log
*.pot
*.pyc
__pycache__/
local_settings.py
db.sqlite3
media

# If your build process includes running collectstatic, then you probably don't need or want to include staticfiles/
# in your Git repository. Update and uncomment the following line accordingly.
# <django-project-name>/staticfiles/

### Django.Python Stack ###
# Byte-compiled / optimized / DLL files
*.py[cod]
*$py.class

# C extensions
*.so

# Distribution / packaging
.Python
build/
develop-eggs/
dist/
downloads/
eggs/
.eggs/
lib/
lib64/
parts/
sdist/
var/
wheels/
pip-wheel-metadata/
share/python-wheels/
*.egg-info/
.installed.cfg
*.egg
MANIFEST

# PyInstaller
#  Usually these files are written by a python script from a template
#  before PyInstaller builds the exe, so as to inject date/other infos into it.
*.manifest
*.spec

# Installer logs
pip-log.txt
pip-delete-this-directory.txt

# Unit test / coverage reports
htmlcov/
.tox/
.nox/
.coverage
.coverage.*
.cache
nosetests.xml
coverage.xml
*.cover
.hypothesis/
.pytest_cache/

# Translations
*.mo

# Django stuff:

# Flask stuff:
instance/
.webassets-cache

# Scrapy stuff:
.scrapy

# Sphinx documentation
docs/_build/

# PyBuilder
target/

# Jupyter Notebook
.ipynb_checkpoints

# IPython
profile_default/
ipython_config.py

# pyenv
.python-version

# pipenv
#   According to pypa/pipenv#598, it is recommended to include Pipfile.lock in version control.
#   However, in case of collaboration, if having platform-specific dependencies or dependencies
#   having no cross-platform support, pipenv may install dependencies that don’t work, or not
#   install all needed dependencies.
#Pipfile.lock

# celery beat schedule file
celerybeat-schedule

# SageMath parsed files
*.sage.py

# Environments
.env
.venv
env/
venv/
ENV/
env.bak/
venv.bak/

# Spyder project settings
.spyderproject
.spyproject

# Rope project settings
.ropeproject

# mkdocs documentation
/site

# mypy
.mypy_cache/
.dmypy.json
dmypy.json

# Pyre type checker
.pyre/

### JupyterNotebook ###
*/.ipynb_checkpoints/*

# Remove previous ipynb_checkpoints
#   git rm -r .ipynb_checkpoints/
#

### Python ###
# Byte-compiled / optimized / DLL files

# C extensions

# Distribution / packaging

# PyInstaller
#  Usually these files are written by a python script from a template
#  before PyInstaller builds the exe, so as to inject date/other infos into it.

# Installer logs

# Unit test / coverage reports

# Translations

# Django stuff:

# Flask stuff:

# Scrapy stuff:

# Sphinx documentation

# PyBuilder

# Jupyter Notebook

# IPython

# pyenv

# pipenv
#   According to pypa/pipenv#598, it is recommended to include Pipfile.lock in version control.
#   However, in case of collaboration, if having platform-specific dependencies or dependencies
#   having no cross-platform support, pipenv may install dependencies that don’t work, or not
#   install all needed dependencies.

# celery beat schedule file

# SageMath parsed files

# Environments

# Spyder project settings

# Rope project settings

# mkdocs documentation

# mypy

# Pyre type checker

# End of https://www.gitignore.io/api/django,python,jupyternotebook

django/apps/public/static

nginx/ssl_certs/
!.gitkeep

data
postgres/data
.idea
*/.idea

*/node_modules
*/.DS_Store
*/dist
*/dist-ssr
*/*.local
```

提交版本

```bash
git add .
git commit -m "客户端你搭建"
git push origin master
```



## 2、初始化前端项目

删除默认提供的HelloWorld.vue组件和src/APP.vue中的默认样式和内容。

App.vue，代码：

```vue
<template>

</template>

<script setup>

</script>

<style>

</style>
```

接下来，我们可以查看效果了，一张白纸~

![image-20210714064542209](4%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81.assets/image-20210714064542209.png)

vite.config.js，代码：

```javascript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [vue()],
  
})
```



## 3、安装路由组件vue-router

### 3.1、下载路由组件

前面没有安装vue-router，使用以下命令在**vue根目录下**安装路由组件：

```bash
cd fuguangweb
yarn add vue-router@next
```

中文文档：https://next.router.vuejs.org/zh/

### 3.2、配置路由

#### 3.2.1、初始化路由对象

创建`src/router/index.js`，代码：

```javascript
import {createRouter, createWebHistory} from 'vue-router'

// 路由列表
const routes = [

]

// 路由对象实例化
const router = createRouter({
  // history, 指定路由的模式
  history: createWebHistory(),
  // 路由列表
  routes,
});


// 暴露路由对象
export default router
```



#### 3.2.2、注册路由组件

在main.js文件，把router对象注册到vue项目中，代码：

```javascript
import { createApp } from 'vue'
import App from './App.vue'
import router from "./router/index.js";
createApp(App).use(router).mount('#app')
```



### 3.3、在视图中显示路由对应的内容

在App.vue组件中，添加显示路由对应的内容。代码：

```vue
<template>
  <router-view></router-view>
</template>

<script setup>

</script>

<style>

</style>
```

提交版本

```bash
git add .
git commit -m "前端初始化并安装集成vue-router"
git push origin master
```



### 3.4、创建并提供前端首页和登陆的组件

routers/index.js

```javascript
import {createRouter, createWebHistory} from 'vue-router'

// 路由列表
const routes = [
  {
    meta:{
        title: "浮光在线教育-首页",
        keepAlive: true
    },
    path: '/',         // uri访问地址
    name: "Home",
    component: ()=> import("../views/Home.vue")
  },
  {
    meta:{
        title: "浮光在线教育-用户登录",
        keepAlive: true
    },
    path:'/login',      // uri访问地址
    name: "Login",
    component: ()=> import("../views/Login.vue")
  }
]

// 路由对象实例化
const router = createRouter({
  // history, 指定路由的模式
  history: createWebHistory(),
  // 路由列表
  routes,
});


// 暴露路由对象
export default router
```

### 3.5、创建Home组件

views/Home.vue，代码：

```vue
<template>
  <h1>首页</h1>
</template>

<script setup>

</script>

<style scoped>

</style>
```

### 3.6、创建Login组件

views/Login.vue，代码：

```vue
<template>
  <h1>登录</h1>
</template>

<script setup>

</script>

<style scoped>

</style>
```



## 4、引入element-plus

官方文档：https://element-plus.org/#/zh-CN

```bash
cd ~/Desktop/fuguang/fuguangweb
yarn add element-plus
```

### 按需导入element-plus到vue项目中

文档：https://element-plus.gitee.io/zh-CN/guide/quickstart.html#按需导入

首先需要安装 `unplugin-vue-components`。

```bash
cd ~/Desktop/fuguang/fuguangweb
yarn add unplugin-vue-components
```

vite配置文件， fuguangweb/vite.config.ts，加载上面刚安装的导入插件，代码：

```javascript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import Components from 'unplugin-vue-components/vite'
import { ElementPlusResolver } from 'unplugin-vue-components/resolvers'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [
      vue(),
      Components({
        resolvers: [ElementPlusResolver()],
      }),
  ]
});
```

Home组件中，调用elementUI的基本样式，测试下是否成功引入。Home.vue，代码：

```vue
<template>
  <h1>首页</h1>
  <el-row>
    <el-button round>圆角按钮</el-button>
    <el-button type="primary" round>主要按钮</el-button>
    <el-button type="success" round>成功按钮</el-button>
    <el-button type="info" round>信息按钮</el-button>
    <el-button type="warning" round>警告按钮</el-button>
    <el-button type="danger" round>危险按钮</el-button>
    <el-rate v-model="store.value2" :colors="store.colors"> </el-rate>
  </el-row>
</template>

<script setup>
import {reactive} from "vue";
const store = reactive({
  value2: null,
  colors: ['#99A9BF', '#F7BA2A', '#FF9900'],
})
</script>

<style scoped>

</style>
```

访问浏览器，效果：

![image-20211109103908093](4%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81.assets/image-20211109103908093.png)

提交版本

```bash
git add .
git commit -m "客户端按需加载element-plus前端组件"
git push origin master
```



成功引入了Element-plus以后，接下来我们就可以开始进入前端页面开发，首先是首页。接下来我们把由前端工程师完成的首页，直接拿过来使用[注意除了组件以外,还有静态文件也需要拿过来,包括App.vue里面的公共样式]，并运行项目。

## 5、全局css初始化

全局css初始化代码，防止出现浏览器之间的怪异bug和避免外观不一致。

src/App.vue，代码：

```vue
<template>
  <router-view></router-view>
</template>

<script setup>

</script>

<style>
/* 声明全局样式和项目的初始化样式 */
body,h1,h2,h3,h4,p,table,tr,td,ul,li,a,form,input,select,option,textarea{
  margin:0;
  padding: 0;
  font-size: 15px;
}
a{
  text-decoration: none;
  color: #333;
  cursor: pointer;
}
ul,li{
  list-style: none;
}
table{
  border-collapse: collapse; /* 合并边框 */
}
img{
  max-width: 100%;
  max-height: 100%;
}
input{
  outline: none;
}
</style>
```

提交版本

```bash
git add .
git commit -m "客户端全局初始化css样式"
git push origin master
```



## 6、显示首页

views/Home.vue中添加代码：

```vue
<template>
  <div class="home">
    <Header></Header>
    
    <Footer></Footer>
  </div>
</template>

<script setup>
import Header from "../components/Header.vue"
import Footer from "../components/Footer.vue"

</script>

<style scoped>

</style>
```

components/Header.vue

```vue
<template>
    <div class="header-box">
      <div class="header">
        <div class="content">
          <div class="logo">
            <router-link to="/"><img src="../assets/logo.png" alt=""></router-link>
          </div>
          <ul class="nav">
              <li><router-link to="">免费课</router-link></li>
              <li><router-link to="">项目课</router-link></li>
              <li><router-link to="">学位课</router-link></li>
              <li><router-link to="">习题库</router-link></li>
              <li><router-link to="">老男孩教育</router-link></li>
          </ul>
          <div class="search-warp">
            <div class="search-area">
              <input class="search-input" placeholder="请输入关键字..." type="text" autocomplete="off">
              <div class="hotTags">
                <router-link to="/search/?words=Vue" target="_blank" class="">Vue</router-link>
                <router-link to="/search/?words=Python" target="_blank" class="last">Python</router-link>
              </div>
            </div>
            <div class="showhide-search" data-show="no"><img class="imv2-search2" src="../assets/search.svg" /></div>
          </div>
          <div class="login-bar">
            <div class="shop-cart full-left">
              <img src="../assets/cart.svg" alt="" />
              <span><router-link to="/cart">购物车</router-link></span>
            </div>
            <div class="login-box full-left">
              <span>登录</span>
              &nbsp;/&nbsp;
              <span>注册</span>
            </div>
          </div>
        </div>
      </div>
    </div>
</template>


<script setup>

</script>

<style scoped>
.header-box{
  height: 72px;
}
.header{
  width: 100%;
  height: 72px;
  box-shadow: 0 0.5px 0.5px 0 #c9c9c9;
  position: fixed;
  top:0;
  left: 0;
  right:0;
  margin: auto;
  z-index: 99;
  background: #fff;
}
.header .content{
  max-width: 1366px;
  width: 100%;
  margin: 0 auto;
}
.header .content .logo a{
}
.header .content .logo{
  height: 72px;
  line-height: 72px;
  margin: 0 20px;
  float: left;
  cursor: pointer; /* 设置光标的形状为爪子 */
}
.header .content .logo img{
  vertical-align: middle;
  margin: -40px;
}
.header .nav li{
  float: left;
  height: 80px;
  line-height: 80px;
  margin-right: 30px;
  font-size: 16px;
  color: #4a4a4a;
  cursor: pointer;
}
.header .nav li span{
  padding-bottom: 16px;
  padding-left: 5px;
  padding-right: 5px;
}
.header .nav li span a{
  display: inline-block;
}
.header .nav li .this{
  color: #4a4a4a;
  border-bottom: 4px solid #ffc210;
}
.header .nav li:hover span{
  color: #000;
}

/*首页导航全局搜索*/
.search-warp {
  position: relative;
  float: left;
  margin-left: 24px;
}
.search-warp .showhide-search {
  width: 20px;
  height: 24px;
  text-align: right;
  position: absolute;
  display: inline-block;
  right: 0;
  bottom: 24px;
  padding: 0 8px;
  border-radius: 18px;
}
.search-warp .showhide-search i {
  display: block;
  height: 24px;
  color: #545C63;
  cursor: pointer;
  font-size: 18px;
  line-height: 24px;
  width: 20px;
}
.search-area {
  float: right;
  position: relative;
  height: 40px;
  padding-right: 36px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.4);
  zoom: 1;
  background: #F3F5F6;
  border-radius: 4px;
  margin: 16px 0;
  width: 324px;
  box-sizing: border-box;
  font-size: 0;
  -webkit-transition: width 0.3s;
  -moz-transition: width 0.3s;
  transition: width 0.3s;
}
.search-area .search-input {
  padding: 8px 12px;
  font-size: 14px;
  color: #9199A1;
  line-height: 24px;
  height: 40px;
  width: 100%;
  float: left;
  border: 0;
  -webkit-transition: background-color 0.3s;
  -moz-transition: background-color 0.3s;
  transition: background-color 0.3s;
  background-color: transparent;
  -moz-box-sizing: border-box;
  -webkit-box-sizing: border-box;
  -ms-box-sizing: border-box;
  box-sizing: border-box;
}
.search-area .search-input.w100 {
  width: 100%;
}
.search-area .hotTags {
  display: inline-block;
  position: absolute;
  top: 0;
  right: 32px;
}
.search-area .hotTags a {
  display: inline-block;
  padding: 4px 8px;
  height: 16px;
  font-size: 14px;
  color: #9199A1;
  line-height: 16px;
  margin-top: 8px;
  max-width: 60px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.search-area .hotTags a:hover {
  color: #F21F1F;
}
.search-area input::-webkit-input-placeholder {
  color: #A6A6A6;
}
.search-area input::-moz-placeholder {
  /* Mozilla Firefox 19+ */
  color: #A6A6A6;
}
.search-area input:-moz-placeholder {
  /* Mozilla Firefox 4 to 18 */
  color: #A6A6A6;
}
.search-area input:-ms-input-placeholder {
  /* Internet Explorer 10-11 */
  color: #A6A6A6;
}
.search-area .btn_search {
  float: left;
  cursor: pointer;
  width: 30px;
  height: 38px;
  text-align: center;
  -webkit-transition: background-color 0.3s;
  -moz-transition: background-color 0.3s;
  transition: background-color 0.3s;
}
.search-area .search-area-result {
  position: absolute;
  left: 0;
  top: 57px;
  width: 300px;
  margin-bottom: 20px;
  border-top: none;
  background-color: #fff;
  box-shadow: 0 8px 16px 0 rgba(7, 17, 27, 0.2);
  font-size: 12px;
  overflow: hidden;
  display: none;
  z-index: 800;
  border-bottom-right-radius: 8px;
  border-bottom-left-radius: 8px;
}
.search-area .search-area-result.hot-hide {
  top: 47px;
}
.search-area .search-area-result.hot-hide .hot {
  display: none;
}
.search-area .search-area-result.hot-hide .history {
  border-top: 0;
}
.search-area .search-area-result h2 {
  font-size: 12px;
  color: #1c1f21;
  line-height: 12px;
  margin-bottom: 8px;
  font-weight: 700;
}
.search-area .search-area-result .hot {
  padding: 12px 0 8px 12px;
  box-sizing: border-box;
}
.search-area .search-area-result .hot .hot-item {
  background: rgba(84, 92, 99, 0.1);
  border-radius: 12px;
  padding: 4px 12px;
  line-height: 16px;
  margin-right: 4px;
  margin-bottom: 4px;
  display: inline-block;
  cursor: pointer;
  font-size: 12px;
  color: #545c63;
}
.search-area .search-area-result .history {
  border-top: 1px solid rgba(28, 31, 33, 0.1);
  box-sizing: border-box;
}
.search-area .search-area-result .history li {
  height: 40px;
  line-height: 40px;
  padding: 0 10px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  color: #787d82;
  cursor: pointer;
}
.search-area .search-area-result .history li:hover,
.search-area .search-area-result .history li .light {
  color: #1c1f21;
  background-color: #edf0f2;
}


.header .login-bar{
  margin-top: 20px;
  height: 80px;
  float: right;
}
.header .login-bar .shop-cart{
  float: left;
  margin-right: 20px;
  border-radius: 17px;
  background: #f7f7f7;
  cursor: pointer;
  font-size: 14px;
  height: 28px;
  width: 88px;
  line-height: 32px;
  text-align: center;
}
.header .login-bar .shop-cart:hover{
  background: #f0f0f0;
}
.header .login-bar .shop-cart img{
  width: 15px;
  margin-right: 4px;
  margin-left: 6px;
}
.header .login-bar .shop-cart span{
  margin-right: 6px;
}
.header .login-bar .login-box{
  float: left;
  height: 28px;
  line-height: 30px;
}
.header .login-bar .login-box span{
  color: #4a4a4a;
  cursor: pointer;
}
.header .login-bar .login-box span:hover{
  color: #000000;
}
</style>
```

components/Footer.vue

```vue
<template>
    <div class="footer">
      <ul>
        <li><router-link to="">企业服务</router-link></li>
        <li><router-link to="">关于我们</router-link></li>
        <li><router-link to="">联系我们</router-link></li>
        <li><router-link to="">商务合作</router-link></li>
        <li><router-link to="">帮助中心</router-link></li>
        <li><router-link to="">意见反馈</router-link></li>
        <li><router-link to="">新手指南</router-link></li>
      </ul>
      <p>Copyright © fuguang.com版权所有 | 京ICP备17072161号-1</p>
    </div>
</template>

<script setup>

</script>

<style scoped>
.footer {
  width: 100%;
  height: 128px;
  color: #545C63;
}
.footer ul{
  margin: 0 auto 16px;
  padding-top: 38px;
  width: 930px;
}
.footer ul li{
  float: left;
  width: 112px;
  margin: 0 10px;
  text-align: center;
  font-size: 14px;
}
.footer ul::after{
  content:"";
  display:block;
  clear:both;
}
.footer p{
  text-align: center;
  font-size: 12px;
}
</style>
```

提交版本

```bash
git add .
git commit -m "客户端显示首页"
git push origin master
```

## 7、CORS跨域支持

在开发中一般前端和后端往往处于不同的2个域名地址下，为了模拟真实环境，我们一般也会为前端和后端分别设置两个不同的本地域名进行模拟。

| 位置 | 域名             |
| ---- | ---------------- |
| 前端 | `www.fuguang.cn` |
| 后端 | `api.fuguang.cn` |

vim编辑`/etc/hosts`文件，可以设置本地域名

```bash
sudo vim /etc/hosts
```

在文件中增加两条信息，并保存文件内容。

```shell
127.0.0.1   localhost
127.0.0.1   api.fuguang.cn
127.0.0.1   www.fuguang.cn
```

在使用pycharm运行web客户端项目时，默认以www.fuguang.cn:3000启动项目。

![image-20211109112506076](4%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81.assets/image-20211109112506076.png)

访问www.fuguang.cn:3000客户端网址，效果：

![image-20210714115430404](4%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81.assets/image-20210714115430404.png)



在使用pycharm运行api服务端项目时，默认以api.fuguang.cn:8000启动。

![image-20211109112149537](4%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81.assets/image-20211109112149537.png)

访问http://www.fuguang.cn:8000/home/demo/服务端网址，效果：

![image-20211109112058149](4%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81.assets/image-20211109112058149.png)



现在前端与后端分处不同的域名，因为客户端访问不同源的服务端时会遭到浏览器的同源策略的拦截，所以我们需要配置CORS，一般开发中配置CORS有2种方案：

1.  web客户端的vue项目中配置vue.config.js实现跨域（使用vite搭建的vue项目，则配置文件是vite.config.js）
2.  api服务端的django项目中配置cors实现跨域

两种方式中可以任选其一，工作中我们与前端开发人员商量解决。

### 配置vue-cli/vite本身内置的nodejs来实现跨域代理(第一种跨域)

vite.config.js，代码：

```javascript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import Components from 'unplugin-vue-components/vite'
import { ElementPlusResolver } from 'unplugin-vue-components/resolvers'

// https://vitejs.dev/config/
export default defineConfig({
    plugins: [
        vue(),
            Components({
            resolvers: [ElementPlusResolver()],
        }),
    ],
    server: {
        port: '3000',           // 客户端的运行端口，此处也可以绑定vue运行的端口，当然也可以写在pycharm下
        host: 'www.fuguang.cn', // 客户端的运行地址，此处也可以绑定vue运行的域名，当然也可以写在pycharm下
        // 跨域代理
        proxy: {
            '/api': {
                // 凡是遇到 /api 路径的请求，都映射到 target 属性  /api/header/  ---> http://api.fuguang.cn:8000/header/
                target: 'http://api.fuguang.cn:8000/',
                changeOrigin: true,
                ws: true,    // 是否支持websocket跨域
                rewrite: path => path.replace(/^\/api/, '')
            }
        }
  }
})
```



### Django安装跨域组件实现CORS代理(第二种跨域)

使用api服务端配置的话，则前端就可以先屏蔽掉了，vite.config.js，代码：

```javascript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import Components from 'unplugin-vue-components/vite'
import { ElementPlusResolver } from 'unplugin-vue-components/resolvers'

// https://vitejs.dev/config/
export default defineConfig({
    plugins: [
        vue(),
            Components({
            resolvers: [ElementPlusResolver()],
        }),
    ],
    // server: {
    //     port: '3000',           // 客户端的运行端口，此处也可以绑定vue运行的端口，当然也可以写在pycharm下
    //     host: 'www.fuguang.cn', // 客户端的运行地址，此处也可以绑定vue运行的域名，当然也可以写在pycharm下
    //     // 跨域代理
    //     proxy: {
    //         '/api': {
    //             // 凡是遇到 /api 路径的请求，都映射到 target 属性  /api/header/  ---> http://api.fuguang.cn:8000/header/
    //             target: 'http://api.fuguang.cn:8000/',
    //             changeOrigin: true,
    //             ws: true,    // 是否支持websocket跨域
    //             rewrite: path => path.replace(/^\/api/, '')
    //         }
    //     }
    // }
})

```

安装跨域组件

```python
pip install django-cors-headers
```

文档：https://github.com/ottoyiu/django-cors-headers/

添加子应用，settings/dev.py，代码：

```python
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework',
    'corsheaders', # cors跨域子应用
    
    'home',  # apps已经在上面加入到python的系统导包路径列表了，这里还是出现背景颜色，原因是python虽然找到home，pycharm不知道。所以可以鼠标右键，设置apps为mark as source root
]
```

中间件注册【必须写在第一个位置】，settings/dev.py，代码：

```python
MIDDLEWARE = [
    'corsheaders.middleware.CorsMiddleware',  # cors跨域的中间件
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]
```

添加客户端访问服务端的白名单，设置允许哪些客户端客户端跨域访问服务端，settings/dev.py，代码：

```python
# CORS的配置信息: 
# 方案1：
# CORS_ORIGIN_WHITELIST = (
#     'http://www.fuguang.cn:3000',
# )
# CORS_ALLOW_CREDENTIALS = False  # 不允许ajax跨域请求时携带cookie

# 方案2：
CORS_ALLOW_ALL_ORIGINS = True
```

![image-20211109114907125](4%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA%E5%8F%8A%E8%B7%A8%E5%9F%9F%E6%94%AF%E6%8C%81.assets/image-20211109114907125.png)

完成了上面的步骤，我们现在就可以通过后端提供数据给前端使用ajax访问了。



## 8、客户端集成axios

安装axios工具插件

```
cd fuguangweb
yarn add axios@next
```

src/views/Home.vue，先测试服务端的跨域是否能使用，代码：

```vue
<template>
  <div class="home">
    <Header></Header>

    <Footer></Footer>
  </div>
</template>

<script setup>
// vite中导入非ts.js文件时，必须填写文件后缀
import Header from "../components/Header.vue"
import Footer from "../components/Footer.vue"

// 测试CORS的跨域配置是否有问题
import axios from "axios"
const http = axios.create()

// 测试服务端的跨域是否配置成功
http.get("/api/home/demo/").then(response=>{
  console.log(response.data);
})

// // 测试服务端的跨域是否配置成功
// http.get("http://api.fuguang.cn:8000/home/demo/").then(response=>{
//   console.log(response.data);
// })
</script>

<style scoped>

</style>
```

上面的测试代码仅仅用于测试跨域是否有问题。

提交版本

```bash
git add .
git commit -m "服务端和客户端分配不同域名，仿真开发，CORS跨域配置"
git push origin master
```



那么如果要在项目中使用axios进行ajax请求，肯定需要在新建一个axios的初始化脚本文件src/utils/http.js中进行初始化配置。src/utils/http.js，代码：

```javascript
import axios from "axios"

const http = axios.create({
    // timeout: 2500,                          // 请求超时，有大文件上传需要关闭这个配置
    baseURL: "http://api.fuguang.cn:8000",     // 设置api服务端的默认地址[如果基于服务端实现的跨域，这里可以填写api服务端的地址，如果基于nodejs客户端测试服务器实现的跨域，则这里不能填写api服务端地址]
    withCredentials: false,                    // 是否允许客户端ajax请求时携带cookie
})

// 请求拦截器
http.interceptors.request.use((config)=>{
    console.log("http请求之前");
    return config;
}, (error)=>{
    console.log("http请求错误");
    return Promise.reject(error);
});

// 响应拦截器
http.interceptors.response.use((response)=>{
    console.log("服务端响应数据成功以后，返回结果给客户端的第一时间，执行then之前");
    return response;
}, (error)=>{
    console.log("服务端响应错误内容的时候。...");
    return Promise.reject(error);
});

export default http;
```

src/views/Home.vue，代码：

```vue
<template>
  <div class="home">
    <Header></Header>

    <Footer></Footer>
  </div>
</template>

<script setup>
// vite中导入非ts.js文件时，必须填写文件后缀
import Header from "../components/Header.vue"
import Footer from "../components/Footer.vue"

// 测试CORS的跨域配置是否有问题
import http from "../utils/http";

// 测试服务端的跨域是否配置成功
// http.get("/api/home/demo/").then(response=>{
//   console.log(response.data);
// })

// 测试服务端的跨域是否配置成功
http.get("/home/demo/").then(response=>{
  console.log(response.data);
})
</script>

<style scoped>

</style>
```

提交版本

```bash
git add .
git commit -m "客户端集成并配置axios"
git push origin master
```
