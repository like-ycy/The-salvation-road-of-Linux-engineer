# 查询参数

声明不属于路径参数的其他函数参数时，它们将被自动解释为 "查询字符串" 参数

```python
from fastapi import FastAPI

app = FastAPI()

fake_items_db = [{"item_name": "Foo"}, {"item_name": "Bar"}, {"item_name": "Baz"}]


@app.get("/items/")

async def read_item(skip: int = 0, limit: int = 10):

    return fake_items_db[skip : skip + limit]

```

如上代码，如果函数里的参数不是路径参数的一部分，那么这样的参数就自动被解释为**请求参数**。

请求参数就是 URL 中问号 ('?') 后面以 '&' 间隔开的键值对，它们是 URL 的一部分，并且参数类型都是字符串类型。

例如，在以下 url 中：

```
http://127.0.0.1:8000/items/?skip=0&limit=10
```

... 查询参数为：

- `skip`：对应的值为 `0`
- `limit`：对应的值为 `10`

应用于路径参数的所有相同过程也适用于查询参数：

- （很明显的）编辑器支持
- 数据 "解析"
- 数据校验
- 自动生成文档

## 1、查询参数缺省值

查询参数在 URL 路径中并不是固定不变的，它们是可选的，并且也可以有缺省值。

在上面的代码示例中，`skip=0`和`limit=100`就是默认值。

因此，访问 URL：

```
http://127.0.0.1:8000/items/
```

将与访问以下地址相同：

```
http://127.0.0.1:8000/items/?skip=0&limit=10
```

但是，如果你访问的是：

```
http://127.0.0.1:8000/items/?skip=20
```

函数中的参数值将会是：

- `skip=20`：在 URL 中设定的值
- `limit=10`：使用默认值

但是，如果你访问的是：

```
http://127.0.0.1:8000/items/?skip=20
```

函数中的参数值将会是：

- `skip=20`：在 URL 中设定的值
- `limit=10`：使用默认值



## 2、可选查询参数

通过同样的方式，你可以将它们的默认值设置为 `None` 来声明可选查询参数：

```python
@app.get('/item/{item_id}')
async def read_item(item_id: str, name: str = None):
    return f'item_id >>> {item_id}, name >>>> {name}'
```

在这个例子中，函数参数 `name` 将是可选的，并且默认值为 `None`。

>**FastAPI** 足够聪明，能够分辨出参数 `item_id` 是路径参数而 `name`  是一个查询参数。

访问 URL：

```
http://127.0.0.1:8000/item/12
```

或者带上查询参数：

```
http://127.0.0.1:8000/item/123?name=123
```



## 3、查询参数类型转换

```python
@app.get('/item/{item_id}')
async def read_item(item_id: str, name: str = None, sex: bool = False):
    return f'item_id >>> {item_id}, name >>>> {name}, sex >>>>> {sex}'
```

这个例子中，如果你访问：

```
http://127.0.0.1:8000/items/foo?sex=1
```

或

```
http://127.0.0.1:8000/items/foo?sex=True
```

或

```
http://127.0.0.1:8000/items/foo?sex=true
```

或

```
http://127.0.0.1:8000/items/foo?sex=on
```

或

```
http://127.0.0.1:8000/items/foo?sex=yes
```

或任何其他的变体形式（大写，首字母大写等等），你的函数接收的 `sex` 参数都会是布尔值 `True`。对于值为 `False` 的情况也是一样的。



## 4、多路径和查询参数

你可以同时声明多个路径参数、多个查询参数，并且不用考虑声明顺序。FastAPI 可以准确无误的识别参数类型。

```python
@app.get('/users/{user_id}/item/{item_id}')
async def read_user(user_id: int, item_id: str, name: str = None, sex: bool = False):
    item = {
        "item_id": item_id,
        "user_id": user_id
    }
    if name:
        item.update({"name": name})
    if sex:
        item.update({"sex": "女"})
    return item
```

访问 URL：

```
http://127.0.0.1:8000/users/12/item/hahaha?name=jack&sex=on
```

结果：

```json
{
  "item_id": "hahaha",
  "user_id": 12,
  "name": "jack",
  "sex": "女"
}
```



## 5、必须查询参数

如果一个查询参数没有被设置任何缺省值 (包括 None)，那么它就是必选的。

```python
@app.get('/items/{item_id}')
def user(item_id: str, needy: str):
    item = {"item_id": user_id, "needy": needy}
    return item
```

`needy` 是类型为 `str` 的必需查询参数。

如果你在浏览器中打开一个像下面的 URL：

```
http://127.0.0.1:8000/items/foo-item
```

... 因为没有添加必需的参数 `needy`，你将看到类似以下的错误：

```
{
    "detail": [
        {
            "loc": [
                "query",
                "needy"
            ],
            "msg": "field required",
            "type": "value_error.missing"
        }
    ]
}
```

由于 `needy` 是必需参数，因此你需要在 URL 中设置它的值：

```
http://127.0.0.1:8000/items/foo-item?needy=sooooneedy
```

... 这样就正常了：

```
{
    "item_id": "foo-item",
    "needy": "sooooneedy"
}
```

当然，你也可以定义一些参数为必需的，一些具有默认值，而某些则完全是可选的：

```
from fastapi import FastAPI

app = FastAPI()


@app.get("/items/{item_id}")
async def read_user_item(
    item_id: str, needy: str, skip: int = 0, limit: int = None
):
    item = {"item_id": item_id, "needy": needy, "skip": skip, "limit": limit}
    return item
```

在这个例子中，有 3 个查询参数：

- `needy`，一个必需的 `str` 类型参数。
- `skip`，一个默认值为 `0` 的 `int` 类型参数。
- `limit`，一个可选的 `int` 类型参数。

> 你还可以像在 [路径参数](https://fastapi.tiangolo.com/zh/tutorial/path-params/#predefined-values) 中那样使用 `Enum`。





