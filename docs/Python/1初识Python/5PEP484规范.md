# Python的类型注解

## typing模块

自python3.5开始，PEP484为python引入了类型注解(type hints)

- 类型检查，防止运行时出现参数和返回值类型、变量类型不符合。

- 作为开发文档附加说明，方便使用者调用时传入和返回参数类型。

- 该模块加入后并不会影响程序的运行，不会报正式的错误，只有提醒。

  pycharm目前支持typing检查，参数类型错误会黄色提示。

## 常用类型

-   int,long,float: 整型,长整形,浮点型
-   bool,str: 布尔型，字符串类型
-   List, Tuple, Dict, Set:列表，元组，字典, 集合
-   Iterable,Iterator:可迭代类型，迭代器类型
-   Generator：生成器类型

## 基本类型指定

代码：

```python
from typing import List,Dict,Tuple,Union
# 整型
num:int = 100
# 字符串
data:str = "200"
# 布尔值
bo:bool = True
# 列表
data_list:List[str] = ["1","2","3"]
# 字典
data_dict:Dict[str, str] = {"name":"xiaoming",}
# 元组[限制数据和类型]
data_tuple:Tuple[int,int,bool] = (1,2,False)

# 联合类型[泛型]
U1 = Union[str,int] # 只能是字符串或者整形
data_union1:U1 = "20"
data_union2:U1 = 200
data_union3:U1 = [1,2,3]  # 此处不符合要求,出现黄色提示

def test(a:int, b:str) -> str:
    print(a, b)
    return 1000

if __name__ == '__main__':
    test('test', 'abc')

"""
函数test，
a:int  指定了输入参数a为int类型，
b:str  b为str类型，
-> str  返回值为srt类型。

可以看到，
在方法中，我们最终返回了一个int，此时pycharm就会有警告；
当我们在调用这个方法时，参数a我们输入的是字符串，此时也会有警告；
但非常重要的一点是，pycharm只是提出了警告，但实际上运行是不会报错，毕竟python的本质还是动态语言
"""
```



## 复杂的类型标注

代码：

```python
from typing import List
Vector = List[float]

def scale(scalar: float, vector: Vector) -> Vector:
    return [scalar * num for num in vector]

# 类型判定: 传递进行的数据只要类似Vector格式即可，这里也是鸭子类型所导致的.
new_vector = scale(2.0, [1.0, -4.2, 5.4])
```

代码：

```python
from typing import Dict, Tuple, Sequence

ConnectionOptions = Dict[str, str]
Address = Tuple[str, int]
Server = Tuple[Address, ConnectionOptions]


if __name__ == '__main__':
    def broadcast_message1(message: str, servers: Sequence[Server]) -> None:
        print(message)
        print(servers)

    broadcast_message1(message="hello", servers=[(("127.0.0.1", 8080), {"username": "xiaoming"}), (("127.0.0.2", 8080), {"username": "xiaohong"})])


    def broadcast_message2(message: str, servers: Sequence[Tuple[Tuple[str, int], Dict[str, str]]]) -> None:
        print(message)
        print(servers)

    broadcast_message2(message="hello", servers=((("127.0.0.1", 8080), {"username": "xiaoming"}), (("127.0.0.2", 8080), {"username": "xiaohong"})))

    """
    这里需要注意，元组这个类型是比较特殊的，因为它是不可变的。
    所以，当我们指定Tuple[str, str]时，就只能传入长度为2，
    并且元组中的所有元素都是str类型
    """
```



## 泛型

https://docs.python.org/zh-cn/3/library/typing.html

代码：

```python
from typing import Sequence, TypeVar

T = TypeVar('T')      # 定义泛型变量,可以是任意类型的数据
b2:T = True # b2的值可以是任意类型数据
# print(b2)

def first(l: Sequence[T]) -> T:   # Generic function
    return l[0]

# print(first([1,2,3]))

A = TypeVar('A', bool, str, bytes)  # 定义当前泛型的范围只能是字符串或者bytes类型
b3:A = "hello"
b4:A = "hello".encode()
b5:A = True
b6:A = 123  # 提示,类型有问题
```



## 创建变量时的类型指定

代码：

```python
from typing import NamedTuple

class Employee(NamedTuple):
    name: str
    id: int = 3

employee = Employee('Guido')
assert employee.id == 3
```



## typing不足之处：提示错误而不影响代码执行

代码：

```python
from typing import List,Tuple

def test(a:Tuple[str,int],b: List[int]) -> str:
    print(b)
    return 'test'


if __name__ == '__main__':
    test(("127.0.0.1",8080), ['b', 1])

"""
从这个例子可以看出来，虽然我们指定了List[int]即由int组成的列表，
但是，实际中，只要这个列表中存在nt（其他的可以为任何类型），就不会出现警告
"""
```

